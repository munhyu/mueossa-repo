<!DOCTYPE html>
<html
  lang="ko"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/layout}"
>
  <th:block layout:fragment="script"></th:block>

  <th:block layout:fragment="css"> </th:block>

  <th:block layout:fragment="header"></th:block>

  <div layout:fragment="content">
    <div id="category" class="page">
      <div class="section-title4">키워드를 선택하세요</div>

      <div class="divider3"></div>

      <form>
        <!-- 취향 선택 -->
        <div class="preference-buttons2">
          <!-- 감성 카테고리 -->
          <div>
            <label
              for="comf"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctComf == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/comfortable.jpg" alt=" " />
              <span>편한</span>
            </label>
            <input
              type="checkbox"
              id="comf"
              name="ctComf"
              value="Y"
              th:checked="${session.filteredProducts?.ctComf == 'Y'}"
            />

            <label
              for="fluffy"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctFluffy == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/fluffy.jpg" alt=" " />
              <span>폭신한</span>
            </label>
            <input
              type="checkbox"
              id="fluffy"
              name="ctFluffy"
              value="Y"
              th:checked="${session.filteredProducts?.ctFluffy == 'Y'}"
            />

            <label
              for="light"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctLight == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/light.jpg" alt=" " />
              <span>가벼운</span>
            </label>
            <input
              type="checkbox"
              id="light"
              name="ctLight"
              value="Y"
              th:checked="${session.filteredProducts?.ctLight == 'Y'}"
            />

            <label
              for="soft"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctSoft == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/soft.jpg" alt=" " />
              <span>부드러운</span>
            </label>
            <input
              type="checkbox"
              id="soft"
              name="ctSoft"
              value="Y"
              th:checked="${session.filteredProducts?.ctSoft == 'Y'}"
            />

            <label
              for="flat"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctFlat == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/flat.jpg" alt=" " />
              <span>편안한</span>
            </label>
            <input
              type="checkbox"
              id="flat"
              name="ctFlat"
              value="Y"
              th:checked="${session.filteredProducts?.ctFlat == 'Y'}"
            />

            <label
              for="pretty"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctPretty == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/pretty.jpg" alt=" " />
              <span>예쁜</span>
            </label>
            <input
              type="checkbox"
              id="pretty"
              name="ctPretty"
              value="Y"
              th:checked="${session.filteredProducts?.ctPretty == 'Y'}"
            />

            <label
              for="cute"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctCute == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/cute.jpg" alt=" " />
              <span>귀여운</span>
            </label>
            <input
              type="checkbox"
              id="cute"
              name="ctCute"
              value="Y"
              th:checked="${session.filteredProducts?.ctCute == 'Y'}"
            />

            <label
              for="neat"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctNeat == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/neat.jpg" alt=" " />
              <span>깔끔한</span>
            </label>
            <input
              type="checkbox"
              id="neat"
              name="ctNeat"
              value="Y"
              th:checked="${session.filteredProducts?.ctNeat == 'Y'}"
            />

            <label
              for="modern"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctModern == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/modern.jpg" alt=" " />
              <span>모던한</span>
            </label>
            <input
              type="checkbox"
              id="modern"
              name="ctModern"
              value="Y"
              th:checked="${session.filteredProducts?.ctModern == 'Y'}"
            />

            <label
              for="wide"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctWide == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/wide feet.jpg" alt=" " />
              <span>발볼이 넓은</span>
            </label>
            <input
              type="checkbox"
              id="wide"
              name="ctWide"
              value="Y"
              th:checked="${session.filteredProducts?.ctWide == 'Y'}"
            />

            <label
              for="narrow"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctNarrow == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/narrow feet.jpg" alt=" " />
              <span>발볼이 좁은</span>
            </label>
            <input
              type="checkbox"
              id="narrow"
              name="ctNarrow"
              value="Y"
              th:checked="${session.filteredProducts?.ctNarrow == 'Y'}"
            />

            <label
              for="standard"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctStandard == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/normal feet.jpg" alt=" " />
              <span>발볼이 보통</span>
            </label>
            <input
              type="checkbox"
              id="standard"
              name="ctStandard"
              value="Y"
              th:checked="${session.filteredProducts?.ctStandard == 'Y'}"
            />

            <label
              for="hip"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctHip == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/go-to.jpg" alt=" " />
              <span>휘뚜루마뚜루</span>
            </label>
            <input
              type="checkbox"
              id="hip"
              name="ctHip"
              value="Y"
              th:checked="${session.filteredProducts?.ctHip == 'Y'}"
            />

            <label
              for="cost"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctCost == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/value.jpg" alt=" " />
              <span>가격이 착한</span>
            </label>
            <input
              type="checkbox"
              id="cost"
              name="ctCost"
              value="Y"
              th:checked="${session.filteredProducts?.ctCost == 'Y'}"
            />

            <label
              for="strong"
              class="preference-button2"
              th:classappend="${session.filteredProducts?.ctStrong == 'Y'} ? 'selected' : ''"
            >
              <img src="/images/category-icons/durable.jpg" alt=" " />
              <span>튼튼한</span>
            </label>
            <input
              type="checkbox"
              id="strong"
              name="ctStrong"
              value="Y"
              th:checked="${session.filteredProducts?.ctStrong == 'Y'}"
            />
          </div>

          <!-- 신발 종류 구두, 부츠/워커, 스니커즈, 샌들/슬리퍼-->
          <div>
            <br />
            <div class="divider3"></div>
            <div class="section-title3">신발의 종류를 선택하세요</div>
            <input
              type="radio"
              id="shoesSneakers"
              name="pGroup"
              value="스니커즈"
              th:checked="${session.filteredProducts?.pGroup == '스니커즈'}"
            />
            <label
              for="shoesSneakers"
              class="preference-toggle"
              th:classappend="${session.filteredProducts?.pGroup == '스니커즈'} ? 'selected' : ''"
            >
              <img src="/images/shoes/sneekers.png" alt=" " />
              <span>스니커즈</span>
            </label>

            <input
              type="radio"
              id="shoesHeels"
              name="pGroup"
              value="구두"
              th:checked="${session.filteredProducts?.pGroup == '구두'}"
            />
            <label
              for="shoesHeels"
              class="preference-toggle"
              th:classappend="${session.filteredProducts?.pGroup == '구두'} ? 'selected' : ''"
            >
              <img src="/images/shoes/dress_shoes.png" alt=" " />
              <span>구두</span>
            </label>

            <input
              type="radio"
              id="shoesBoots"
              name="pGroup"
              value="부츠/워커"
              th:checked="${session.filteredProducts?.pGroup == '부츠/워커'}"
            />
            <label
              for="shoesBoots"
              class="preference-toggle"
              th:classappend="${session.filteredProducts?.pGroup == '부츠/워커'} ? 'selected' : ''"
            >
              <img src="/images/shoes/boots.png" alt=" " />
              <span>부츠/워커</span>
            </label>

            <input
              type="radio"
              id="shoesSandals"
              name="pGroup"
              value="샌들/슬리퍼"
              th:checked="${session.filteredProducts?.pGroup == '샌들/슬리퍼'}"
            />
            <label
              for="shoesSandals"
              class="preference-toggle"
              th:classappend="${session.filteredProducts?.pGroup == '샌들/슬리퍼'} ? 'selected' : ''"
            >
              <img src="/images/shoes/sandal.png" alt=" " />
              <span>샌들/슬리퍼</span>
            </label>
          </div>

          <div class="divider3"></div>
        </div>
      </form>
      <th:block th:replace="~{fragments/productList :: productList}"></th:block>
    </div>
  </div>

  <th:block layout:fragment="footer"></th:block>

  <th:block layout:fragment="script-footer">
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const filterInputs = document.querySelectorAll(
          ".preference-buttons2 input"
        );
        const productCards = document.querySelectorAll(".product-card");

        function filterProducts() {
          const checked = {};

          // 체크박스 처리
          filterInputs.forEach((input) => {
            if (input.type === "checkbox" && input.checked) {
              checked[input.name.toLowerCase()] = input.value;
            }
          });

          // label의 클래스에 selected가 있는 것만 필터링
          const radioLabels = document.querySelectorAll(".preference-toggle");
          let radioValue = null;
          radioLabels.forEach((label) => {
            if (label.classList.contains("selected")) {
              // for 속성으로 input id 찾기
              const radioInput = document.getElementById(
                label.getAttribute("for")
              );
              if (radioInput && radioInput.name) {
                checked[radioInput.name.toLowerCase()] = radioInput.value;
              }
            }
          });

          // 필터 적용
          productCards.forEach((card) => {
            let show = true;
            for (const key in checked) {
              const dataValue = card.getAttribute("data-" + key.toLowerCase());
              if (dataValue !== checked[key]) {
                show = false;
                break;
              }
            }
            card.style.display = show ? "" : "none";
          });
        }

        // 체크박스 변경 시 필터링 적용
        filterInputs.forEach((input) => {
          input.addEventListener("change", filterProducts);
        });

        // radio 라벨 클릭 시 필터링 적용
        const radioLabels = document.querySelectorAll(".preference-toggle");
        radioLabels.forEach((label) => {
          label.addEventListener("click", filterProducts);
        });

        filterProducts(); // 초기 필터링 적용
      });
    </script>
  </th:block>
</html>
