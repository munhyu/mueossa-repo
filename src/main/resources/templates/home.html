<!-- layout 쓰는 파일-->

<!DOCTYPE html>
<html lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout}">
<th:block layout:fragment="script"></th:block>

<th:block layout:fragment="css"></th:block>

<th:block layout:fragment="header"></th:block>
<!-- 콘텐츠 -->
<div layout:fragment="content">
  <div id="home">
    <div class="banner-slider">
      <button class="prev-slide">〈</button>
      <!-- 이전 슬라이드 버튼 -->
      <div class="slides">
        <img src="/images/banner/무엇사_배너_디자인_01.jpg" alt="배너" />
        <img src="/images/banner/무엇사_배너_디자인_02.jpg" alt="배너" />
        <img src="/images/banner/무엇사_배너_디자인_03.jpg" alt="배너" />
        <img src="/images/banner/무엇사_배너_디자인_04.jpg" alt="배너" />
        <img src="/images/banner/무엇사_배너_디자인_05.jpg" alt="배너" />
        <img src="/images/banner/무엇사_배너_디자인_06.jpg" alt="배너" />
        <img src="/images/banner/무엇사_배너_디자인_07.jpg" alt="배너" />
      </div>
      <button class="next-slide">〉</button>
      <!-- 다음 슬라이드 버튼 -->
    </div>
    <button class="next-slide">〉</button> <!-- 다음 슬라이드 버튼 -->
  </div>

  <div class="main-title">사용자의 취향에 맞는 추천 상품</div>

  <div class="main-title2">사용자의 취향에 맞는 추천 상품</div>

  <div class="divider2"></div>
  <!-- 정렬 버튼 가격 높은 낮은순서, 점수 낮은 높은 순서 -->
  <select id="sortBy">
    <option value="recommend_desc">무엇사 추천순</option>
    <option value="price_asc">낮은 가격순</option>
    <option value="price_desc">높은 가격순</option>
  </select>

  <th:block th:replace="~{fragments/productList :: productList}"></th:block>

</div>
</div>

<th:block layout:fragment="footer"></th:block>
<th:block layout:fragment="script-footer">
<script>
document.addEventListener('DOMContentLoaded', function() {
  const sortSelect = document.getElementById('sortBy');
  const productList = document.querySelector('.product-list');

  if (!sortSelect || !productList) return;

  // 최초 렌더링된 상품 카드 순서를 저장
  const originalCards = Array.from(productList.querySelectorAll('.product-card'));

  sortSelect.addEventListener('change', function() {
    const cards = Array.from(productList.querySelectorAll('.product-card'));

    function getPrice(card) {
      const priceSpan = card.querySelector('.product-price');
      if (!priceSpan) return 0;
      return parseInt(priceSpan.textContent.replace(/[^0-9]/g, ''), 10) || 0;
    }

    let sorted;
    if (sortSelect.value === 'price_asc') {
      sorted = cards.sort((a, b) => getPrice(a) - getPrice(b));
    } else if (sortSelect.value === 'price_desc') {
      sorted = cards.sort((a, b) => getPrice(b) - getPrice(a));
    } else {
      // 추천순 선택 시, 원래 순서로 복원
      productList.innerHTML = '';
      originalCards.forEach(card => productList.appendChild(card));
      return;
    }

    productList.innerHTML = '';
    sorted.forEach(card => productList.appendChild(card));
  });

  // // 기본값 설정 (HTML에서 selected 속성으로도 가능)
  // sortSelect.value = 'recommend_desc';
});
</script>

</th:block>

</html>