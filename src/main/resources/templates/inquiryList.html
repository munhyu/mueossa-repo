<!-- layout 쓰는 파일-->

<!DOCTYPE html>
<html lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout}">
<th:block layout:fragment="script"></th:block>

<th:block layout:fragment="css">
    <style>
        h1 {
            margin-top: 20px;
            font-size: 28px;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }

        table th,
        table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            text-align: left;
        }

        table th {
            background-color: #f7f7f7;
            color: #444;
            font-weight: 600;
        }

        table td {
            color: #555;
            vertical-align: top;
        }

        table tr:hover {
            background-color: #f1f9ff;
        }

        #idx_vlaue {
            display: none;
        }
    </style>
</th:block>

<th:block layout:fragment="header"></th:block>


<th:block layout:fragment="content">

    <h1>문의 게시판</h1>

    <a href="goInquiry">문의하기</a>
    <table>
        <thead>
            <tr>
                <th>제목</th>
                <th>작성자</th>
                <th>작성일</th>
                <th colspan="2">내용</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="inquiry : ${inquiryList}">
                <td th:text="${inquiry.title}"></td>
                <td th:text="${inquiry.uId}"></td>
                <td th:text="${#dates.format(inquiry.createdAt, 'yyyy-MM-dd')}"></td>
                <td th:text="${inquiry.content}"></td>
                <td>
                    <form action="goInquiry" method="post">
                        <input type="hidden" th:value="${inquiry.idx}" name="idx" id="idx_vlaue" />
                        <button type="submit">수정</button>
                    </form>
                    <button type="button" class="delete-btn">삭제</button>
                </td>
            </tr>
        </tbody>
    </table>

</th:block>

<th:block layout:fragment="footer"></th:block>


<th:block layout:fragment="script-footer">

    <script th:inline="javascript">
        // 각 삭제 버튼에 개별 이벤트 바인딩 (동적으로 여러 개 처리)
        $(document).on("click", ".delete-btn", function () {
            if (confirm("정말 삭제하시겠습니까?")) {
                var idx = $(this).closest("tr").find("input[name='idx']").val();
                fetch("deleteInquiry", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: idx.toString()
                })
                    .then(response => {
                        if (response.ok) {
                            location.reload(); // 페이지 새로고침
                        } else {
                            alert("삭제 실패");
                        }
                    });
            }
        });
    </script>

</th:block>

</html>